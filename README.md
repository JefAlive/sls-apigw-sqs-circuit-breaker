
# Serverless Circuit Breaker

AWS + Serverless Framework Circuit Breaker pattern for a Processing Queue use case.

## Motivation

There are many Circuit Breakers patterns, right? The most popular pattern is like this:

![API Gateway - Lambda - Circuit Breaker - External API image here]()

I consider the image above an anti-pattern, however this pattern was developed in order to put the API Gateway requests in a processing queue, so it will have a processing queue Lambda that depends on an external API (that may fail at certain times of the day), but with this circuit breaker it can track these fail attempts and avoid processing the queue while external API doesn't reestabilish. Once the circuit is aborted by fail attempts, this project provides a health checker on external API in order to reactivate the processing queue when the API responds successfuly a /status endpoint.

![This pattern image here]()

The advantage here is avoiding processing when external API is not responding properly, lowering costs and fail attempts.

I highly recommend checking out [this article](https://www.serverlessguru.com/blog) I made for Serverless Guru Blog, you will find a full explanation about this pattern in there.

## Stack

- Serverless Framework 3.0
- Serverless Framework project structure generated by [CloudGTO](https://www.cloudgto.com) â€” Powerful cloud optmization platform!
- Serverless Compose
- AWS API Gateway
- AWS Lambda & EventSourceMapping
- AWS SQS
- AWS SNS
- AWS EventBridge

## Features

- API Gateway sends request for a Processing Queue in SQS
- A Queue Consumer Lambda consumes the processing queue
- The Queue Consumer Lambda sends external API fail attempts for Circuit Breaker Lambda
- The Circuit Breaker Lambda enables/disables the queue consumer and health checker
- Health checker Lambda notify Circuit Breaker Lambda when everything is ok

## Deploy

This command will deploy to `us-east-1`, stage `dev`:

```bash
  npm run deploy
```

## Examples of use

```sh
curl -X POST https://{yourUrlAfterDeployHere}/dev/items -H "Content-Type: application/json" -d '{ "randomObject": "yeahhh" }'
```

## References

[Serverless Guru Blog Article](https://www.serverlessguru.com/blog) - You can check my article on Serverless Guru blog with full explanation about this Circuit Breaker pattern.